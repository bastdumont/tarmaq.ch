<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signature de la Charte - tarmaq</title>
    <meta
      name="description"
      content="Signez la Charte tarmaq pour soutenir notre engagement pour un avenir num√©rique inclusif et responsable."
    />

    <link rel="icon" href="assets/favicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#DA2F2C',
              secondary: '#111827',
              accent: '#F3F4F6',
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
          },
        },
      };
    </script>
  </head>
  <body class="font-sans bg-white text-secondary">
    <!-- Header will be loaded by header.js -->

    <!-- Page Content -->
    <section
      class="pt-32 pb-20 bg-gradient-to-br from-secondary via-gray-800 to-primary text-white"
    >
      <div class="container mx-auto px-4">
        <div class="max-w-2xl mx-auto text-center mb-12">
          <div class="inline-block mb-4">
            <span
              class="bg-white/20 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm font-semibold"
            >
              üìú Signature
            </span>
          </div>
          <h1 class="text-4xl md:text-5xl font-bold mb-4">
            Signez la Charte tarmaq
          </h1>
          <p class="text-xl opacity-90">
            Manifestez votre soutien √† notre mission et vos valeurs communes
          </p>
        </div>
      </div>
    </section>

    <!-- Form Section -->
    <section class="py-20 bg-white">
      <div class="container mx-auto px-4">
        <div class="max-w-2xl mx-auto">
          <!-- Error/Success Messages -->
          <div
            id="errorMessage"
            class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-r-lg hidden"
          >
            <div class="flex items-center">
              <i class="fas fa-exclamation-circle mr-3"></i>
              <span id="errorText"></span>
            </div>
          </div>

          <div
            id="successMessage"
            class="bg-green-50 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-r-lg hidden"
          >
            <div class="flex items-center">
              <i class="fas fa-check-circle mr-3"></i>
              <span id="successText"></span>
            </div>
          </div>

          <!-- Form Card -->
          <div
            class="bg-white border-2 border-gray-200 rounded-2xl shadow-xl p-8 md:p-12"
          >
            <form id="charterForm">
              <div class="mb-6">
                <label
                  for="name"
                  class="block text-gray-700 font-semibold mb-2"
                >
                  Nom complet <span class="text-primary">*</span>
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  placeholder="Jean Dupont"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition outline-none"
                />
              </div>

              <div class="mb-6">
                <label
                  for="email"
                  class="block text-gray-700 font-semibold mb-2"
                >
                  Email <span class="text-primary">*</span>
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  placeholder="jean.dupont@example.com"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition outline-none"
                />
              </div>

              <div class="mb-8">
                <div class="flex items-start gap-3">
                  <input
                    type="checkbox"
                    id="acceptCharter"
                    name="acceptCharter"
                    required
                    class="mt-1 w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary accent-primary"
                  />
                  <label
                    for="acceptCharter"
                    class="text-gray-700 text-sm leading-relaxed cursor-pointer"
                  >
                    J'accepte la
                    <a
                      href="main-charte.html"
                      class="text-primary font-semibold hover:underline"
                      target="_blank"
                      >charte</a
                    >
                    et les conditions g√©n√©rales
                    <span class="text-primary">*</span>
                  </label>
                </div>
              </div>

              <button
                type="submit"
                id="submitButton"
                class="w-full bg-primary hover:bg-red-700 text-white font-bold py-4 px-8 rounded-lg transition transform hover:scale-105 shadow-lg"
              >
                <i class="fas fa-pen-fancy mr-2"></i>
                Signer la charte
              </button>
            </form>
          </div>

          <!-- Back to Charter Link -->
          <div class="text-center mt-8">
            <a
              href="main-charte.html"
              class="text-primary hover:text-red-700 font-semibold inline-flex items-center"
            >
              <i class="fas fa-arrow-left mr-2"></i>
              Retour √† la charte
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-secondary text-white py-12">
      <div class="container mx-auto px-4">
        <div class="grid md:grid-cols-4 gap-8 mb-8">
          <div>
            <img src="assets/logo.png" alt="tarmaq" class="h-12 mb-4" />
            <p class="text-gray-400 text-sm" data-i18n="footer.about">
              Catalyseur de motivation pour les jeunes talents dans les
              technologies √©mergentes.
            </p>
          </div>

          <div>
            <h4 class="font-bold mb-4" data-i18n="footer.links">
              Liens rapides
            </h4>
            <ul class="space-y-2 text-gray-400 text-sm">
              <li>
                <a
                  href="projet.html"
                  class="hover:text-white transition"
                  data-i18n="nav.project"
                  >Le projet</a
                >
              </li>
              <li>
                <a
                  href="activites.html"
                  class="hover:text-white transition"
                  data-i18n="nav.activities"
                  >Activit√©s</a
                >
              </li>
              <li>
                <a
                  href="impact.html"
                  class="hover:text-white transition"
                  data-i18n="nav.impact"
                  >Impact</a
                >
              </li>
              <li>
                <a
                  href="soutenir.html"
                  class="hover:text-white transition"
                  data-i18n="nav.support"
                  >Nous soutenir</a
                >
              </li>
              <li>
                <a
                  href="tokenomics.html"
                  class="hover:text-white transition"
                  data-i18n="nav.tokenomics"
                  >Tokenomics</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h4 class="font-bold mb-4" data-i18n="footer.contact">Contact</h4>
            <ul class="space-y-2 text-gray-400 text-sm">
              <li>
                <i class="fas fa-envelope mr-2"></i>bastien@bdi-solutions.com
              </li>
              <li><i class="fas fa-phone mr-2"></i>+41 79 670 77 43</li>
              <li>
                <i class="fas fa-map-marker-alt mr-2"></i>11 avenue
                Eug√®ne-Pittard, 1206 Gen√®ve
              </li>
            </ul>
          </div>

          <div>
            <h4 class="font-bold mb-4" data-i18n="footer.newsletter">
              Restez Inform√©
            </h4>
            <p
              class="text-gray-400 text-sm mb-4"
              data-i18n="footer.newsletter.description"
            >
              Recevez nos derni√®res actualit√©s et opportunit√©s.
            </p>
            <a
              href="contact.html"
              class="bg-primary hover:bg-red-700 text-white px-4 py-2 rounded-full text-sm transition inline-flex items-center"
              data-i18n="footer.newsletter.cta"
            >
              Nous Contacter
            </a>
          </div>
        </div>

        <div
          class="border-t border-gray-700 pt-8 text-center text-gray-400 text-sm"
        >
          <p>
            &copy; 2025 tarmaq.
            <span data-i18n="footer.rights">Tous droits r√©serv√©s.</span>
          </p>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="js/header.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/main.js"></script>

    <script>
      (async function () {
        // Load configuration from Vercel serverless function
        let AIRTABLE_API_KEY = '';
        let BASE_ID = 'appJ4MLPYJyuWWBG8';
        const TABLE_NAME = 'Charter Signatures';

        try {
          const response = await fetch('/api/env.js');
          if (response.ok) {
            const config = await response.json();
            AIRTABLE_API_KEY = config.AIRTABLE_API_KEY;
            if (config.AIRTABLE_BASE_ID) {
              BASE_ID = config.AIRTABLE_BASE_ID;
            }
            console.log('‚úÖ Configuration loaded from Vercel');
          } else {
            throw new Error('Failed to load config from /api/env.js');
          }
        } catch (error) {
          console.error('‚ùå Failed to load configuration:', error);
          const errorEl = document.getElementById('errorMessage');
          const errorTextEl = document.getElementById('errorText');
          errorTextEl.textContent =
            'Configuration error: Unable to load API configuration.';
          errorEl.classList.remove('hidden');
          document.getElementById('submitButton').disabled = true;
          return;
        }

        // Check if API key is configured
        if (!AIRTABLE_API_KEY) {
          console.error('‚ùå AIRTABLE_API_KEY is empty');
          const errorEl = document.getElementById('errorMessage');
          const errorTextEl = document.getElementById('errorText');
          errorTextEl.textContent =
            'Configuration error: API key not found. Please contact support.';
          errorEl.classList.remove('hidden');
          document.getElementById('submitButton').disabled = true;
          return;
        }

        const form = document.getElementById('charterForm');
        const submitButton = document.getElementById('submitButton');
        const errorEl = document.getElementById('errorMessage');
        const successEl = document.getElementById('successMessage');
        const errorTextEl = document.getElementById('errorText');
        const successTextEl = document.getElementById('successText');

        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          // Reset messages
          errorEl.classList.add('hidden');
          successEl.classList.add('hidden');

          // Disable button during submission
          submitButton.disabled = true;
          submitButton.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>Envoi en cours...';

          // Get form data
          const name = document.getElementById('name').value;
          const email = document.getElementById('email').value;
          const acceptCharter =
            document.getElementById('acceptCharter').checked;

          if (!acceptCharter) {
            errorTextEl.textContent =
              'Vous devez accepter la charte et les conditions g√©n√©rales.';
            errorEl.classList.remove('hidden');
            submitButton.disabled = false;
            submitButton.innerHTML =
              '<i class="fas fa-pen-fancy mr-2"></i>Signer la charte';
            return;
          }

          // Create current date in ISO format
          const now = new Date().toISOString();
          const signatureDate = new Date().toLocaleDateString('fr-FR');

          try {
            const response = await fetch(
              `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(
                TABLE_NAME
              )}`,
              {
                method: 'POST',
                headers: {
                  Authorization: `Bearer ${AIRTABLE_API_KEY}`,
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  fields: {
                    Name: name,
                    Email: email,
                    Timestamp: now,
                    Signature_Date: signatureDate,
                  },
                }),
              }
            );

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(
                errorData.error?.message || "Erreur lors de l'envoi"
              );
            }

            // Success
            successTextEl.textContent =
              '‚úÖ Merci ! Votre signature a √©t√© enregistr√©e avec succ√®s.';
            successEl.classList.remove('hidden');
            form.reset();
          } catch (error) {
            console.error('Erreur:', error);
            errorTextEl.textContent = `Une erreur s'est produite : ${error.message}`;
            errorEl.classList.remove('hidden');
          } finally {
            submitButton.disabled = false;
            submitButton.innerHTML =
              '<i class="fas fa-pen-fancy mr-2"></i>Signer la charte';
          }
        });
      })();
    </script>
  </body>
</html>
